name: Docker Image CI

on:
  push:
    tags: [ 'v*.*.*' ]

jobs:

  Build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Build the Docker image
      run: docker build . --file Dockerfile --tag mssql-lambda

    - name: Create Container from Image
      run: docker run --rm --volume $(pwd):/tmp mssql-lambda cp /layer.zip /tmp/pyodbc-mssql-python312-x86_64.zip

    - name: Upload layer artifact
      uses: actions/upload-artifact@v4
      with:
        name: pyodbc-mssql-python312-x86_64.zip
        path: pyodbc-mssql-python312-x86_64.zip

    - name: Create release
      uses: ncipollo/release-action@v1
      with:
        artifacts: pyodbc-mssql-python312-x86_64.zip